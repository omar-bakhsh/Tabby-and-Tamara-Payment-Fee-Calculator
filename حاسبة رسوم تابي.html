<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حاسبة رسوم تابي المتقدمة</title>
    <style>
        :root {
            --primary-color: #4a6cf7;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --border-color: #dee2e6;
            --bg-light: #f8f9fa;
            --installment-color: #8e44ad;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7f9;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .container {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), #3a56d5);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
        }
        
        .calculator {
            padding: 25px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .input-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 18px;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px;
            background-color: var(--bg-light);
            border-radius: 8px;
            transition: background-color 0.3s;
        }
        
        .checkbox-group:hover {
            background-color: #e9ecef;
        }
        
        .checkbox-group input {
            margin-left: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .checkbox-group label {
            font-weight: 500;
            cursor: pointer;
        }
        
        .additional-fee {
            background-color: #fff8e1;
            border-right: 4px solid var(--warning-color);
        }
        
        .customer-fee {
            background-color: #e8f5e9;
            border-right: 4px solid var(--success-color);
        }
        
        .results {
            background-color: var(--bg-light);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-title {
            font-weight: 500;
        }
        
        .result-value {
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .highlight {
            color: var(--success-color);
            font-size: 1.1em;
        }
        
        .deduction {
            color: var(--danger-color);
        }
        
        .installment {
            color: var(--installment-color);
            font-size: 1.1em;
        }
        
        .installment-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed var(--border-color);
        }
        
        .installment-section .result-item:last-child {
            border-bottom: none;
        }
        
        .note {
            margin-top: 25px;
            padding: 15px;
            background-color: #e8f4fc;
            border-radius: 8px;
            font-size: 14px;
            color: var(--primary-color);
            border-right: 4px solid var(--primary-color);
        }
        
        .action-button {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        
        .tabby-button {
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            width: 100%;
            max-width: 300px;
        }
        
        .tabby-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
            background: linear-gradient(135deg, #FF5252, #FF7B3D);
        }
        
        .tabby-button:active {
            transform: translateY(0);
        }
        
        .tabby-button i {
            font-size: 18px;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 20px;
                padding: 15px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .tabby-button {
                padding: 12px 25px;
                font-size: 15px;
            }
        }
    </style>
    <!-- رابط أيقونات Font Awesome للأيقونة -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>حاسبة رسوم تابي المتقدمة</h1>
            <p>احسب رسوم تابي مع الخيارات الإضافية</p>
             <p>Develope By : <a href="https://kayan.dev" target="_blank" style="color:#fff; font-size: smaller;">kayan platform </a></p>
        </div>
        
        <div class="calculator">
            <div class="input-group">
                <label for="billAmount">مبلغ الفاتورة شامل الضريبة (ريال سعودي)</label>
                <input type="number" id="billAmount" placeholder="أدخل المبلغ" min="0" step="any" value="1000">
            </div>
            
            <div class="checkbox-group additional-fee">
                <input type="checkbox" id="additionalFee">
                <label for="additionalFee">إضافة رسوم عدم اكتمال المبلغ 2500 في دورة التحويل (28.75 ريال)</label>
            </div>
            
            <div class="checkbox-group customer-fee">
                <input type="checkbox" id="customerPaysFee" checked>
                <label for="customerPaysFee">تحميل نسبة تابي على العميل</label>
            </div>
            
            <div class="results">
                <div class="result-item">
                    <span class="result-title">مبلغ الفاتورة الأساسي</span>
                    <span class="result-value" id="baseAmount">1,000.00 ر.س</span>
                </div>
                
                <div class="result-item">
                    <span class="result-title">رسوم العمليات (8.5%)</span>
                    <span class="result-value" id="operationFees">85.00 ر.س</span>
                </div>
                
                <div class="result-item">
                    <span class="result-title">ضريبة على رسوم العمليات (15%)</span>
                    <span class="result-value" id="taxOnFees">12.75 ر.س</span>
                </div>
                
                <div class="result-item" id="additionalFeeRow" style="display: none;">
                    <span class="result-title">رسوم عدم اكتمال المبلغ</span>
                    <span class="result-value" id="additionalFeeValue">+28.75 ر.س</span>
                </div>
                
                <div class="result-item deduction" id="deductionRow" style="display: none;">
                    <span class="result-title">الخصم من الفاتورة (الرسوم والضريبة)</span>
                    <span class="result-value" id="deductionValue">-97.75 ر.س</span>
                </div>
                
                <div class="result-item highlight">
                    <span class="result-title">الإجمالي النهائي</span>
                    <span class="result-value" id="totalFees">1,097.75 ر.س</span>
                </div>
                
                <!-- قسم الدفعات -->
                <div class="installment-section">
                    <div class="result-item">
                        <span class="result-title">مبلغ الفاتورة مقسم على 4 دفعات</span>
                        <span class="result-value" id="installmentAmount">274.44 ر.س</span>
                    </div>
                </div>
            </div>
            
            <!-- زر الانتقال إلى تابي أعمال -->
            <div class="action-button">
                <button class="tabby-button" id="goToTabbyButton">
                    <i class="fas fa-external-link-alt"></i>
                    الانتقال إلى تابي أعمال لبدء العملية
                </button>
            </div>
            
            <div class="note">
                <p>كيفية الحساب:</p>
                <p>1. أدخل مبلغ الفاتورة الإجمالي</p>
                <p>2. رسوم العمليات = مبلغ الفاتورة × 8.5%</p>
                <p>3. الضريبة = رسوم العمليات × 15%</p>
                <p>4. إذا تم تحميل النسبة على العميل: الإجمالي = مبلغ الفاتورة + رسوم العمليات + الضريبة + الرسوم الإضافية</p>
                <p>5. إذا لم يتم تحميل النسبة على العميل: الإجمالي = مبلغ الفاتورة - رسوم العمليات - الضريبة - الرسوم الإضافية</p>
                <p>6. رسوم عدم اكتمال المبلغ (28.75 ريال) تُضاف عندما يتحمل العميل النسبة وتُخصم عندما يتحمل التاجر النسبة</p>
                <p>7. قيمة الدفعة الأولى = الإجمالي النهائي ÷ 4</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const billAmountInput = document.getElementById('billAmount');
            const additionalFeeCheckbox = document.getElementById('additionalFee');
            const customerPaysFeeCheckbox = document.getElementById('customerPaysFee');
            const baseAmountElement = document.getElementById('baseAmount');
            const operationFeesElement = document.getElementById('operationFees');
            const taxOnFeesElement = document.getElementById('taxOnFees');
            const additionalFeeRow = document.getElementById('additionalFeeRow');
            const additionalFeeValueElement = document.getElementById('additionalFeeValue');
            const deductionRow = document.getElementById('deductionRow');
            const deductionValueElement = document.getElementById('deductionValue');
            const totalFeesElement = document.getElementById('totalFees');
            const installmentAmountElement = document.getElementById('installmentAmount');
            const firstInstallmentElement = document.getElementById('firstInstallment');
            const goToTabbyButton = document.getElementById('goToTabbyButton');
            
            // دالة حساب الرسوم
            function calculateFees() {
                const billAmount = parseFloat(billAmountInput.value) || 0;
                const hasAdditionalFee = additionalFeeCheckbox.checked;
                const customerPaysFee = customerPaysFeeCheckbox.checked;
                
                // حساب رسوم العمليات (8.5%)
                const operationFees = billAmount * 0.085;
                
                // حساب الضريبة على رسوم العمليات (15%)
                const taxOnFees = operationFees * 0.15;
                
                // حساب الرسوم الإضافية (تضاف أو تخصم حسب من يتحمل التكلفة)
                let additionalFee = 0;
                if (hasAdditionalFee) {
                    additionalFee = customerPaysFee ? 28.75 : -28.75;
                }
                
                // حساب الإجمالي
                let totalFees;
                
                if (customerPaysFee) {
                    // إذا تحمل العميل الرسوم
                    totalFees = billAmount + operationFees + taxOnFees + additionalFee;
                    deductionRow.style.display = 'none';
                } else {
                    // إذا تحمل التاجر الرسوم
                    totalFees = billAmount - operationFees - taxOnFees + additionalFee;
                    deductionValueElement.textContent = formatCurrency(-(operationFees + taxOnFees));
                    deductionRow.style.display = 'flex';
                }
                
                // حساب قيمة الدفعة الأولى (الفاتورة مقسمة على 4)
                const installmentAmount = totalFees / 4;
                
                // تحديث القيم في الواجهة
                baseAmountElement.textContent = formatCurrency(billAmount);
                operationFeesElement.textContent = formatCurrency(operationFees);
                taxOnFeesElement.textContent = formatCurrency(taxOnFees);
                
                // تحديث عرض رسوم عدم اكتمال المبلغ
                if (hasAdditionalFee) {
                    if (customerPaysFee) {
                        additionalFeeValueElement.textContent = "+28.75 ر.س";
                        additionalFeeValueElement.classList.remove('deduction');
                    } else {
                        additionalFeeValueElement.textContent = "-28.75 ر.س";
                        additionalFeeValueElement.classList.add('deduction');
                    }
                    additionalFeeRow.style.display = 'flex';
                } else {
                    additionalFeeRow.style.display = 'none';
                }
                
                totalFeesElement.textContent = formatCurrency(totalFees);
                installmentAmountElement.textContent = formatCurrency(installmentAmount);
                firstInstallmentElement.textContent = formatCurrency(installmentAmount);
                
                // تغيير لون الإجمالي إذا كان سالباً
                if (totalFees < 0) {
                    totalFeesElement.classList.add('deduction');
                    totalFeesElement.classList.remove('highlight');
                } else {
                    totalFeesElement.classList.remove('deduction');
                    totalFeesElement.classList.add('highlight');
                }
            }
            
            // دالة تنسيق العملة
            function formatCurrency(amount) {
                return amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",") + ' ر.س';
            }
            
            // إضافة مستمعات الأحداث
            billAmountInput.addEventListener('input', calculateFees);
            additionalFeeCheckbox.addEventListener('change', calculateFees);
            customerPaysFeeCheckbox.addEventListener('change', calculateFees);
            
            // حدث الزر للانتقال إلى صفحة تابي
            goToTabbyButton.addEventListener('click', function() {
                window.open('https://merchant.tabby.ai/', '_blank');
            });
            
            // بدء الحساب بالقيمة الافتراضية
            calculateFees();
        });
    </script>
</body>
</html>